---
title: "AE_background_assesment"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(tidyr)
library(RColorBrewer)
library(plyr)
library(dplyr)
library(tibble)
library(ggsignif)
```

##Read in csv and make df in wideform and longform (measurements taken in the absence of ligand)
Read in csv.
Formatting of csv: each column is a different colony, first row is the name of the colony, each column is then filled with OD corrected fluorescence values (there should be three values per biological replicate, each of which are the technical replicates). Far right column is the condition of the growth, either - or + ligand. For this particular switch, -L=repression and +L=expression. For those colonies that have less raw data values than the controls, the empty cells are filled with an integer that can be removed easily (-2) to be turned into NA when inputted into R. 
Put NA in place of -2 (which was how NA was denoted in the csv).
This is for repression and expression, fold induction will not be included because it will be calculated based on the included repression and expression values.
```{r read in csv}
AE_ODcorr1 <- read.csv("AE_ODcorr.csv", header=T)
empty_columns <- sapply(AE_ODcorr1, function(x) all(is.na(x) | x==""))
AE_ODcorr <- AE_ODcorr1[,!empty_columns]
AE_ODcorr[AE_ODcorr == -2] <-NA
AE_ODcorr_rep1 <- AE_ODcorr[AE_ODcorr == "(-)",]
#dataframe of just repression
AE_ODcorr_rep <- AE_ODcorr_rep1[rowSums(is.na(AE_ODcorr_rep1)) !=ncol(AE_ODcorr_rep1),]
#remove rows that were only NA and delete dataframe that was filled with NA only columns
#anchor_rep[,40] <- as.numeric(anchor_rep[,40], na.rm=TRUE)
#one of the columns was being read in as a character so this fixes that one
rm(AE_ODcorr1)
rm(AE_ODcorr_rep1)
#make long form df
long_AE_ODcorr <- gather(AE_ODcorr_rep, Colony_Name, OD_corr_fluor, -LIGAND)
```

##ANOVA
###repression 
```{r, echo=FALSE}
AE_ODcorr.aov <- aov(OD_corr_fluor ~ Colony_Name, data=long_AE_ODcorr)
summary(AE_ODcorr.aov)
colony_comparisons <- TukeyHSD(AE_ODcorr.aov)
AE_ODcorr_rep_confidence_interval <- as.data.frame(colony_comparisons[["Colony_Name"]])
AE_ODcorr_rep_confidence_interval <- rownames_to_column(AE_ODcorr_rep_confidence_interval)
AE_ODcorr_repvsPBR_confidence_interval <- AE_ODcorr_rep_confidence_interval[grep("PBR", AE_ODcorr_rep_confidence_interval[,1]),]
is_sigAE_PBR <- vector()
for(ii in 1:nrow(AE_ODcorr_repvsPBR_confidence_interval)) {
  if(AE_ODcorr_repvsPBR_confidence_interval[ii,5] < 0.001) {
    is_sigAE_PBR[ii] <- 3
  }
  else if(AE_ODcorr_repvsPBR_confidence_interval[ii,5] < 0.01) {
    is_sigAE_PBR[ii] <- 2
  }
  else if(AE_ODcorr_repvsPBR_confidence_interval[ii,5] < 0.05) {
    is_sigAE_PBR[ii] <- 1
  }
  else{
    is_sigAE_PBR[ii] <- 0
  }
}
AE_ODcorr_repvsPBR_confidence_interval <- cbind(AE_ODcorr_repvsPBR_confidence_interval, is_sigAE_PBR)
``` 

```{r, echo=FALSE}
ggplot(long_AE_ODcorr, aes(x=reorder(Colony_Name,-OD_corr_fluor, na.rm=TRUE), y=OD_corr_fluor))+
    geom_boxplot(alpha=0.8)+
   labs(title="OD corrected Fluorescence", x="Colony", y="Fluorescence")+
   scale_y_log10()+
    theme_classic()+
    theme(axis.text.x = element_text(face="bold", angle=90), plot.title = element_text(hjust=0.5, face="bold"), axis.text.y = element_text(face="bold"), axis.title.x = element_text(face = "bold"), legend.position = "none")


``` 
